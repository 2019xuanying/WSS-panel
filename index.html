<!DOCTYPE html>
<!-- 
  V8.2.0 (Axiom Refactor V2.0.5)
  - [AXIOM V2.0.5] ä¿®å¤: ç§»é™¤äº† "INTERNAL_IPC_PORT" çš„é…ç½® UIï¼Œ
    å› ä¸º IPC (WS) ç°åœ¨ä¸ Panel (HTTP) å…±äº«åŒä¸€ä¸ªç«¯å£ã€‚
  - [AXIOM V2.0.4] ä¿®å¤: é‡æ–°æ·»åŠ äº†ç¼ºå¤±çš„ "è½½è·ç”Ÿæˆå™¨" (Payload Generator) 
    HTML è§†å›¾ (id="view-payload-gen")ã€‚
  - [AXIOM V2.0.4] ä¿®å¤: å°† "ä¿®æ”¹ç®¡ç†å‘˜å¯†ç " è¡¨å•ä¸­çš„ id ä¿®å¤ä¸º
    "admin-new-password" å’Œ "admin-confirm-new-password"ã€‚
  - [AXIOM V2.0.1] æ–°å¢: "ç«¯å£é…ç½®" è§†å›¾ (id="view-port-config")ã€‚
  - [AXIOM V2.0.0] æ¶æ„: ç§»é™¤æ‰€æœ‰å†…è” <script>ï¼Œ
    æ›¿æ¢ä¸º <script src="app.js" defer></script>ã€‚
  - [AXIOM V2.0.0] æ¶æ„: ç§»é™¤ FLASK_CONFIG æ¨¡æ¿ã€‚
  - [AXIOM V2.1.0] æ–°å¢: SNI æŸ¥æ‰¾å™¨ UIã€‚
  - [AXIOM V2.1.1] ä¿®å¤: è½½è·ç”Ÿæˆå™¨è§†å›¾çš„ 3 åˆ—å¸ƒå±€ã€‚
  - [AXIOM V2.2.0] ä¿®å¤: åœ¨â€œæ–°å¢ç”¨æˆ·â€è¡¨å•ä¸­æ·»åŠ å®æ—¶ä»¤ç‰Œç”Ÿæˆå™¨ UIã€‚
  - [AXIOM V2.2.1] å¸ƒå±€: ä¼˜åŒ–ä¾§è¾¹æ åˆ†ç»„ã€‚
  - [AXIOM V2.2.1] å¸ƒå±€: å°†â€œæ–°å¢ç”¨æˆ·â€ç§»è‡³æ¨¡æ€æ¡†ï¼Œæå‡ç”¨æˆ·åˆ—è¡¨ä¼˜å…ˆçº§ã€‚
-->
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSS éš§é“ç®¡ç†é¢æ¿</title>
    
    <!-- 1. å¼•å…¥ CDN é“¾æ¥ -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* å¼•å…¥ Inter å­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
        }
        
        /* ... [ä¿ç•™çš„åŸå§‹æ ·å¼] ... */
        .log-pre { font-family: monospace; font-size: 0.8rem; white-space: pre; overflow-x: auto; max-height: 200px; }
        .ip-banned-tag { background-color: #fca5a5; color: #dc2626; font-weight: 600; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] { -moz-appearance: textfield; }
        #batch-action-bar {
            transition: all 0.3s ease-in-out;
            transform: translateY(-100%);
            opacity: 0;
            left: 0;
        }
        @media (min-width: 1024px) { /* lg */
            #batch-action-bar {
                left: 16rem; 
            }
        }
        #batch-action-bar.visible {
            transform: translateY(0);
            opacity: 1;
        }
        .sortable {
            cursor: pointer;
            user-select: none;
        }
        .sortable:hover {
            color: var(--fallback-p,oklch(var(--p)/var(--tw-text-opacity,1)));
        }
        .sort-arrow {
            display: inline-block;
            width: 1em;
            opacity: 0.4;
        }
        .token-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .usage-progress {
            height: 6px;
            margin-top: 4px;
        }
        
        .speed-cell span {
            display: inline-block;
            min-width: 65px; 
            text-align: left;
        }
        .speed-cell .speed-up { color: #34d399; /* green-400 */ }
        .speed-cell .speed-down { color: #fbbf24; /* amber-400 */ }
        
        .speed-mobile { font-family: monospace; }
        .speed-mobile .speed-up { color: #34d399; }
        .speed-mobile .speed-down { color: #fbbf24; }
        
    </style>
</head>
<body class="bg-base-200">

    <!-- å“åº”å¼æŠ½å±‰å¸ƒå±€ (Drawer) -->
    <div class="drawer lg:drawer-open">
        <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
        
        <!-- ======================= -->
        <!-- é¡µé¢å†…å®¹ (Content)       -->
        <!-- ======================= -->
        <div class="drawer-content flex flex-col">
            
            <!-- Header / å¯¼èˆªæ  (DaisyUI Navbar) -->
            <header class="navbar bg-base-100/80 backdrop-blur-md sticky top-0 z-30 shadow-sm border-b border-base-300/50">
                <!-- ... [ä¿ç•™çš„ Header å†…å®¹] ... -->
                 <div class="flex-none lg:hidden">
                    <label for="my-drawer-2" class="btn btn-ghost btn-square drawer-button">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </label>
                </div>
                <div class="flex-1">
                     <h1 class="text-lg sm:text-xl font-bold text-base-content tracking-wide px-2">
                        <i data-lucide="shield-check" class="w-5 h-5 inline-block -mt-1 mr-2 text-primary"></i>
                        WSS éš§é“ç®¡ç†é¢æ¿
                    </h1>
                </div>
                <div class="flex-none gap-2">
                    <label class="swap swap-rotate btn btn-ghost btn-circle">
                        <input type="checkbox" id="theme-toggle" class="theme-controller" value="dark" />
                        <i data-lucide="sun" class="swap-on fill-current w-5 h-5"></i>
                        <i data-lucide="moon" class="swap-off fill-current w-5 h-5"></i>
                    </label>
                    <button onclick="logout()" class="btn btn-error btn-sm shadow-md hidden sm:inline-flex">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        é€€å‡º
                    </button>
                    <button onclick="logout()" class="btn btn-error btn-sm btn-square shadow-md sm:hidden">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                    </button>
                </div>
            </header>

            <!-- å†…å®¹åŒºåŸŸ -->
            <main class="flex-1 p-4 sm:p-6 lg:p-8">
                
                <!-- å…¨å±€çŠ¶æ€ä¿¡æ¯/è­¦å‘Š (DaisyUI Alert) -->
                <div id="status-message" class="alert shadow-lg hidden mb-6" role="alert">
                    <!-- JS ä¼šåŠ¨æ€å¡«å……å†…å®¹ -->
                </div>

                <!-- 1. ä»ªè¡¨ç›˜è§†å›¾ (é»˜è®¤æ˜¾ç¤º) -->
                <div id="view-dashboard" >
                    <!-- å®æ—¶ç³»ç»ŸçŠ¶æ€å¡ç‰‡ (DaisyUI Stats) -->
                    <section class="mb-8">
                        <h2 class="text-xl font-semibold text-base-content mb-4">æ ¸å¿ƒåŸºç¡€è®¾æ–½çŠ¶æ€</h2>
                        <div id="system-status-grid" class="stats stats-vertical lg:stats-horizontal shadow w-full">
                            <p class="stat text-gray-500">æ­£åœ¨åŠ è½½ç³»ç»ŸçŠ¶æ€...</p>
                        </div>
                    </section>
                    
                    <!-- å¿«é€Ÿç”¨æˆ·ç»Ÿè®¡ (å›¾è¡¨åŒ–) -->
                    <section class="mb-8">
                        <h2 class="text-xl font-semibold text-base-content mb-4">ç”¨æˆ·å¿«é€Ÿç»Ÿè®¡</h2>
                        <div class="card bg-base-100 shadow-xl">
                            <div class="card-body p-6">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                    <!-- ç”œç”œåœˆå›¾å®¹å™¨ -->
                                    <div class="md:col-span-1 h-48 w-full max-w-xs mx-auto">
                                        <canvas id="user-stats-chart"></canvas>
                                    </div>
                                    <!-- ç»Ÿè®¡æ•°æ®æ–‡æœ¬ -->
                                    <div id="user-quick-stats-text" class="md:col-span-2 stats stats-vertical shadow">
                                        <p class="stat text-gray-500">æ­£åœ¨åŠ è½½ç”¨æˆ·ç»Ÿè®¡...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- ç«¯å£çŠ¶æ€å’Œæ ¸å¿ƒæ“ä½œ (DaisyUI Card) -->
                    <section class="card bg-base-100 shadow-xl mb-8">
                        <!-- ... [ä¿ç•™çš„ç«¯å£çŠ¶æ€å†…å®¹] ... -->
                        <div class="card-body p-6">
                            <h2 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">æœåŠ¡ç«¯å£ä¸æ§åˆ¶</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div id="port-status-data" class="md:col-span-1 p-4 bg-base-200 rounded-lg space-y-2 text-sm border border-base-300">
                                    <p class="text-gray-500">æ­£åœ¨æ£€æŸ¥ç«¯å£çŠ¶æ€...</p>
                                </div>
                                <div class="md:col-span-2 space-y-3">
                                    <button onclick="confirmAction('wss', 'restart', null, 'serviceControl', 'é‡å¯ WSS')" class="btn btn-primary w-full">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> é‡å¯ WSS Proxy (<span id="wss-http-port">...</span>/<span id="wss-tls-port">...</span>)
                                    </button>
                                    <button onclick="confirmAction('stunnel4', 'restart', null, 'serviceControl', 'é‡å¯ Stunnel4')" class="btn btn-primary w-full">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> é‡å¯ Stunnel4 (<span id="stunnel-port">...</span>)
                                    </button>
                                    <button onclick="confirmAction('udpgw', 'restart', null, 'serviceControl', 'é‡å¯ UDPGW')" class="btn btn-primary w-full">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> é‡å¯ UDPGW (<span id="udpgw-port">...</span>)
                                    </button>
                                    <button onclick="confirmAction('wss_panel', 'restart', null, 'serviceControl', 'é‡å¯é¢æ¿')" class="btn btn-error w-full">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> é‡å¯ Web Panel (<span id="panel-port">...</span>)
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 2. ç”¨æˆ·ç®¡ç†è§†å›¾ -->
                <div id="view-users" class="hidden">
                    <h2 class="text-2xl font-bold text-base-content mb-6">ğŸ‘¤ ç”¨æˆ·ç®¡ç†</h2>
                    
                    <!-- æ‰¹é‡æ“ä½œæ  (DaisyUI) -->
                    <div id="batch-action-bar" class="fixed top-[68px] right-0 bg-primary text-primary-content p-4 shadow-lg z-20 flex flex-col sm:flex-row items-center justify-between gap-4">
                        <!-- ... [ä¿ç•™çš„æ‰¹é‡æ“ä½œæ å†…å®¹] ... -->
                        <div>
                            <span class="font-bold text-lg">å·²é€‰ä¸­ <span id="selected-user-count">0</span> ä¸ªç”¨æˆ·</span>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <div class="input-group">
                                <input type="number" id="batch-renew-days" value="30" class="input input-bordered input-sm w-20 bg-base-100 text-base-content" placeholder="å¤©æ•°">
                                <button onclick="handleBatchAction('renew')" class="btn btn-secondary btn-sm">
                                    ç»­æœŸ
                                </button>
                            </div>
                            <button onclick="handleBatchAction('enable')" class="btn btn-success btn-sm">å¯ç”¨</button>
                            <button onclick="handleBatchAction('pause')" class="btn btn-warning btn-sm">æš‚åœ</button>
                            <button onclick="handleBatchAction('delete')" class="btn btn-error btn-sm">åˆ é™¤</button>
                        </div>
                    </div>
                    
                    <!-- [AXIOM V2.2.1] å¸ƒå±€: ç§»é™¤ "æ–°å¢ç”¨æˆ·" å¡ç‰‡ï¼Œæ›¿æ¢ä¸ºæŒ‰é’® -->
                    <section class="mb-6">
                        <button onclick="openModal('add-user-modal')" class="btn btn-primary shadow-md">
                            <i data-lucide="user-plus" class="w-4 h-4"></i> æ–°å¢ç”¨æˆ·
                        </button>
                    </section>
                    
                    <!-- [AXIOM V2.2.1] å¸ƒå±€: ç§»é™¤ "ç”¨æˆ·åˆ—è¡¨æœç´¢" å¡ç‰‡ -->
                    
                    <!-- ç”¨æˆ·åˆ—è¡¨ (DaisyUI) -->
                    <section class="card bg-base-100 shadow-xl">
                        <div class="card-body p-6">
                            <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">ç°æœ‰ç”¨æˆ·åˆ—è¡¨</h3>
                            
                            <!-- [AXIOM V2.2.1] å¸ƒå±€: åœ¨æ­¤å¤„æ’å…¥æœç´¢æ¡† -->
                            <div class="form-control mb-4">
                                <label class="label hidden" for="user-search-input"><span class="label-text">æœç´¢ç”¨æˆ·</span></label>
                                <div class="input-group">
                                    <input type="text" id="user-search-input" placeholder="æŒ‰ç”¨æˆ·åæœç´¢..." class="input input-bordered w-full">
                                    <span class="btn btn-square bg-base-200 border border-base-300">
                                        <i data-lucide="search" class="w-5 h-5"></i>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="hidden md:block overflow-x-auto border border-base-300 rounded-lg">
                                <table class="table w-full" role="table">
                                    <thead class="bg-base-200">
                                        <tr>
                                            <th class="px-4 py-3">
                                                <input type="checkbox" id="select-all-users" class="checkbox checkbox-primary">
                                            </th>
                                            <th class="px-6 py-3 sortable" data-sortkey="username" role="columnheader">ç”¨æˆ· <span class="sort-arrow"></span></th>
                                            <th class="px-6 py-3 sortable" data-sortkey="status" role="columnheader">çŠ¶æ€ <span class="sort-arrow"></span></th>
                                            <th class="px-6 py-3 sortable" data-sortkey="expiration_date" role="columnheader">åˆ°æœŸæ—¥ <span class="sort-arrow"></span></th>
                                            <th class="px-6 py-3 sortable" data-sortkey="active_connections" role="columnheader">è¿æ¥ <span class="sort-arrow"></span></th>
                                            <th class="px-6 py-3 sortable" data-sortkey="max_connections" role="columnheader">å¹¶å‘ <span class="sort-arrow"></span></th>
                                            <th class="px-6 py-3 sortable" data-sortkey="usage_gb" role="columnheader">ç”¨é‡ (GB) <span class="sort-arrow"></span></th>
                                            
                                            <th class="px-6 py-3 sortable" data-sortkey="realtime_speed_down" role="columnheader">å®æ—¶ â†‘/â†“ <span class="sort-arrow"></span></th>
                                            
                                            <th class="px-6 py-3" role="columnheader">æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="user-list-tbody" class="bg-base-100 divide-y divide-base-300">
                                        <tr><td colspan="9" class="px-6 py-4 text-center text-gray-500">æ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="user-list-mobile" class="space-y-4 md:hidden">
                                <p class="px-6 py-4 text-center text-gray-500">æ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®...</p>
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- 3. å®æ—¶è¿æ¥ IP åˆ—è¡¨è§†å›¾ -->
                <div id="view-live-ips" class="hidden">
                    <!-- ... [ä¿ç•™çš„ IP åˆ—è¡¨è§†å›¾] ... -->
                     <h2 class="text-2xl font-bold text-base-content mb-6">ğŸ“¡ å®æ—¶è¿æ¥ IP åˆ—è¡¨</h2>
                    <section class="card bg-base-100 shadow-xl">
                        <div class="card-body p-6">
                            <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">å½“å‰è¿æ¥åˆ° WSS/Stunnel ç«¯å£çš„å¤–éƒ¨ IP</h3>
                            <div id="live-ip-list" class="space-y-3 max-h-96 overflow-y-auto p-3 bg-base-200 rounded-lg border border-base-300">
                                <p class="text-gray-500">æ­£åœ¨åŠ è½½å®æ—¶ IP æ•°æ®...</p>
                            </div>
                            <p class="text-xs text-gray-500 mt-4">æ­¤åˆ—è¡¨æ˜¾ç¤º TCP ESTABLISHED çŠ¶æ€çš„è¿æ¥ IPã€‚è¯·è°¨æ…ä½¿ç”¨å°ç¦åŠŸèƒ½ã€‚</p>
                        </div>
                    </section>
                </div>

                <!-- 4. Host ç™½åå•é…ç½®è§†å›¾ -->
                <div id="view-hosts" class="hidden">
                    <!-- ... [ä¿ç•™çš„ Host è§†å›¾] ... -->
                    <h2 class="text-2xl font-bold text-base-content mb-6">âš™ï¸ WSS ä»£ç† Host ç™½åå•ç®¡ç†</h2>
                    <section class="card bg-base-100 shadow-xl">
                        <form onsubmit="event.preventDefault(); saveHosts();" class="card-body p-6">
                            <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">å…æµ Host åˆ—è¡¨é…ç½®</h3>
                            <p class="text-sm text-gray-600 mb-4">WSS ä»£ç†ï¼ˆHttp/Tls ç«¯å£ï¼‰ä»…å…è®¸è¿æ¥æ—¶è¯·æ±‚çš„ Host åœ¨æ­¤åˆ—è¡¨ä¸­çš„æµé‡é€šè¿‡ã€‚ç”¨äºè¿è¥å•†å…æµæˆ–å®šå‘æµé‡è¯†åˆ«ã€‚</p>
                            
                            <textarea id="host-list-textarea" rows="10" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ª Host åŸŸåï¼Œä¾‹å¦‚ï¼š\ncmcc.com\n10086.cn\n..."
                                      class="textarea textarea-bordered w-full font-mono text-sm resize-none"></textarea>
                            
                            <div class="card-actions mt-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                                <p id="host-count-info" class="text-sm text-gray-500">å½“å‰åŠ è½½ 0 ä¸ª Hostã€‚</p>
                                <button type="submit" class="btn btn-primary w-full sm:w-auto flex-shrink-0">
                                    <i data-lucide="save" class="w-4 h-4"></i> ä¿å­˜å¹¶é‡è½½ä»£ç†
                                </button>
                            </div>
                        </form>
                    </section>
                </div>
                
                <!-- [AXIOM V2.0.4] ä¿®å¤: é‡æ–°æ·»åŠ  "è½½è·ç”Ÿæˆå™¨" è§†å›¾ -->
                <!-- 7. è½½è·ç”Ÿæˆå™¨ (Payload Generator) -->
                <div id="view-payload-gen" class="hidden">
                    <h2 class="text-2xl font-bold text-base-content mb-6">ğŸ§¬ è½½è· (Payload) ç”Ÿæˆå™¨</h2>
                    
                    <!-- [AXIOM V2.1.1] ä¿®å¤: å¸ƒå±€ã€‚ä» lg:grid-cols-2 æ”¹ä¸º lg:grid-cols-3 -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        <!-- [AXIOM V2.1.1] ä¿®å¤: è¿™æ˜¯ç¬¬ 1 åˆ— -->
                        <!-- æ¨¡å— A: è½½è·é…ç½® (HTTP Injector) -->
                        <div class="card bg-base-100 shadow-xl">
                            <div class="card-body p-6">
                                <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">
                                    <i data-lucide="sliders-horizontal" class="w-5 h-5 mr-1 text-info"></i>
                                    è½½è·é…ç½® (HTTP Injector)
                                </h3>

                                <!-- [AXIOM V1.7] æ–°å¢: æ‹†åˆ†è½½è· (Payload Eater) -->
                                <div class="form-control p-4 bg-base-200 rounded-lg border border-base-300">
                                    <label class="label cursor-pointer justify-start gap-3">
                                        <input type="checkbox" id="payload-split-enable" class="toggle toggle-primary" checked>
                                        <span class="label-text font-semibold text-base-content">å¯ç”¨æ‹†åˆ†è½½è· (Payload Eater)</span>
                                    </label>
                                    <p class="text-xs text-base-content/70 mt-1 mb-3">
                                        å‘é€ä¸€ä¸ªâ€œå“‘è¯·æ±‚â€(Request 1) ä½œä¸ºâ€œåå™¬è€…â€ï¼ŒæˆåŠŸåå†å‘é€çœŸæ­£çš„â€œå‡çº§è¯·æ±‚â€(Request 2)ã€‚
                                        ç¬¦åˆ `wss_proxy.js` çš„â€œPayload åå™¬â€é€»è¾‘ã€‚
                                    </p>
                                    <div id="payload-split-options" class="space-y-4">
                                        <div class="form-control">
                                            <label class="label" for="payload-r1-method"><span class="label-text">Request 1 æ–¹æ³•</span></label>
                                            <select id="payload-r1-method" class="select select-bordered select-sm w-full">
                                                <option>CONNECT</option>
                                                <option>GET</option>
                                                <option>POST</option>
                                            </select>
                                        </div>
                                        <div class="form-control">
                                            <label class="label" for="payload-r1-host"><span class="label-text">Request 1 URL/Host (ä½¿ç”¨ [host_port])</span></label>
                                            <input type="text" id="payload-r1-host" placeholder="[host_port]" class="input input-bordered input-sm w-full" value="[host_port]">
                                        </div>
                                    </div>
                                </div>
                                <!-- ç»“æŸ V1.7 æ–°å¢ -->

                                <div class="divider text-sm">Request 2 (å‡çº§è¯·æ±‚)</div>
                                
                                <div class="form-control">
                                    <label class="label" for="payload-host"><span class="label-text">Request 2 URL/ä¸»æœº (ä¾‹å¦‚: ubigi.me)</span></label>
                                    <input type="text" id="payload-host" placeholder="ubigi.me" class="input input-bordered w-full" value="ubigi.me">
                                </div>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="form-control">
                                        <label class="label" for="payload-method"><span class="label-text">Request 2 è¯·æ±‚æ–¹æ³•</span></label>
                                        <select id="payload-method" class="select select-bordered w-full">
                                            <option>GET</option>
                                            <option>CONNECT</option>
                                            <option>POST</option>
                                            <option>PUT</option>
                                            <option>HEAD</option>
                                            <option>TRACE</option>
                                            <option>OPTIONS</option>
                                            <option>PATCH</option>
                                            <option>DELETE</option>
                                        </select>
                                    </div>
                                    <div class="form-control">
                                        <label class="label" for="payload-inject-method"><span class="label-text">æ³¨å…¥æ³• (æš‚ä¸æ”¯æŒ)</span></label>
                                        <select id="payload-inject-method" class="select select-bordered w-full" disabled>
                                            <option value="back">Back Inject (é»˜è®¤)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-control">
                                    <label class="label" for="payload-split-method"><span class="label-text">æ‹†åˆ†æ–¹æ³• (ä½¿ç”¨ [split])</span></label>
                                    <select id="payload-split-method" class="select select-bordered w-full" disabled>
                                        <option value="normal">æ­£å¸¸ (R1 [split] R2)</option>
                                    </select>
                                </div>
                                
                                <div class="form-control">
                                    <label class="label"><span class="label-text">Request 2 é¢å¤–çš„å¤´</span></label>
                                    <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                                        <label class="label cursor-pointer justify-start gap-3">
                                            <input type="checkbox" id="payload-header-host" class="checkbox checkbox-sm" checked>
                                            <span class="label-text">Host (åœ¨çº¿)</span>
                                        </label>
                                        <label class="label cursor-pointer justify-start gap-3">
                                            <input type="checkbox" id="payload-header-keep-alive" class="checkbox checkbox-sm" checked>
                                            <span class="label-text">Keep-Alive</span>
                                        </label>
                                        <label class="label cursor-pointer justify-start gap-3">
                                            <input type="checkbox" id="payload-header-user-agent" class="checkbox checkbox-sm" checked>
                                            <span class="label-text">User-Agent</span>
                                        </label>
                                        <label class="label cursor-pointer justify-start gap-3">
                                            <input type="checkbox" id="payload-header-websocket" class="checkbox checkbox-sm" checked>
                                            <span class="label-text">Websocket</span>
                                        </label>
                                        <!-- [AXIOM V1.7] æ–°å¢: X-Online-Host -->
                                        <label class="label cursor-pointer justify-start gap-3">
                                            <input type="checkbox" id="payload-header-online-host" class="checkbox checkbox-sm" checked>
                                            <span class="label-text">X-Online-Host</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- [AXIOM V2.1.1] ä¿®å¤: è¿™æ˜¯ç¬¬ 2 åˆ— -->
                        <!-- [AXIOM V2.1] æ–°å¢: SNI æŸ¥æ‰¾å™¨å¡ç‰‡ -->
                        <div class="card bg-base-100 shadow-xl lg:col-span-1">
                            <div class="card-body p-6">
                                <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">
                                    <i data-lucide="search" class="w-5 h-5 mr-1 text-accent"></i>
                                    SNI æŸ¥æ‰¾å™¨
                                </h3>
                                <p class="text-xs text-base-content/70 mb-2">
                                    è¾“å…¥ä¸€ä¸ªå·²çŸ¥çš„è¿è¥å•†åŸŸå (ä¾‹å¦‚å……å€¼ç½‘ç«™)ï¼Œä»¥å‘ç°å…¶ SSL è¯ä¹¦ä¸Šç»‘å®šçš„å…¶ä»–å¯ç”¨ SNI åŸŸåã€‚
                                </p>
                                <div class="form-control">
                                    <label class="label" for="sni-finder-host"><span class="label-text">è¦æŸ¥è¯¢çš„åŸŸå</span></label>
                                    <div class="input-group">
                                        <input type="text" id="sni-finder-host" placeholder="ä¾‹å¦‚: operator.com" class="input input-bordered w-full">
                                        <button id="sni-finder-btn" onclick="runSniFinder()" class="btn btn-accent btn-square">
                                            <i data-lucide="search" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-control mt-2">
                                    <label class="label"><span class="label-text">æŸ¥è¯¢ç»“æœ:</span></label>
                                    <div class="mockup-code bg-base-200 text-xs max-h-48 overflow-y-auto">
                                        <pre id="sni-finder-results" class="p-4">ç­‰å¾…æŸ¥è¯¢...</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                            
                        <!-- [AXIOM V2.1.1] ä¿®å¤: è¿™æ˜¯ç¬¬ 3 åˆ— -->
                        <!-- æ¨¡å— B & C: è®¤è¯ä¸è¾“å‡º -->
                        <div class="space-y-6"> 
                            
                            <!-- æ¨¡å— B: æœåŠ¡å™¨è®¤è¯ -->
                            <div class="card bg-base-100 shadow-xl">
                                <div class="card-body p-6">
                                    <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">
                                        <i data-lucide="key" class="w-5 h-5 mr-1 text-success"></i>
                                        æœåŠ¡å™¨è®¤è¯ (WSS Panel)
                                    </h3>
                                    <div class="form-control">
                                        <label class="label" for="payload-auth-mode"><span class="label-text">è®¤è¯æ¨¡å¼ (Axiom æ™ºèƒ½æ³¨å…¥)</span></label>
                                        <select id="payload-auth-mode" class="select select-bordered w-full">
                                            <option value="proxy">éœ€è¦è®¤è¯å¤´ (Proxy-Authorization)</option>
                                            <option value="uri">å…è®¤è¯å¤´ (URI æ³¨å…¥)</option>
                                            <option value="none">ä¸æ³¨å…¥ (åŸå§‹è½½è·)</option>
                                        </select>
                                    </div>

                                    <!-- [AXIOM V1.6] æ–°å¢: ä»åˆ—è¡¨é€‰æ‹©ç”¨æˆ· -->
                                    <div class="form-control">
                                        <label class="label" for="payload-user-select"><span class="label-text">ä»åˆ—è¡¨é€‰æ‹©ç”¨æˆ· (å¯é€‰)</span></label>
                                        <select id="payload-user-select" class="select select-bordered w-full">
                                            <option value="">-- æ‰‹åŠ¨è¾“å…¥ --</option>
                                            <!-- JS will populate this -->
                                        </select>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div class="form-control">
                                            <label class="label" for="payload-username"><span class="label-text">ç”¨æˆ·å</span></label>
                                            <input type="text" id="payload-username" placeholder="è¾“å…¥ç”¨æˆ·å" class="input input-bordered w-full">
                                        </div>
                                        <div class="form-control">
                                            <label class="label" for="payload-password"><span class="label-text">å¯†ç </span></label>
                                            <input type="password" id="payload-password" placeholder="è¾“å…¥å¯†ç " class="input input-bordered w-full">
                                        </div>
                                    </div>
                                    <div class="form-control">
                                        <label class="label"><span class="label-text">Base64 ä»¤ç‰Œ (è‡ªåŠ¨ç”Ÿæˆ)</span></label>
                                        <div class="token-input-group">
                                            <input type="text" id="payload-auth-token" readonly class="input input-bordered w-full font-mono text-sm bg-base-200" value="[åœ¨æ­¤è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ]">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ¨¡å— C: ç”Ÿæˆç»“æœ -->
                            <div class="card bg-base-100 shadow-xl">
                                <div class="card-body p-6">
                                    <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">
                                        <i data-lucide="file-output" class="w-5 h-5 mr-1 text-primary"></i>
                                        ç”Ÿæˆç»“æœ
                                    </h3>
                                    
                                    <div class="form-control">
                                        <label class="label" for="payload-output"><span class="label-text">è‡ªå®šä¹‰è½½è· (Payload)</span></label>
                                        <textarea id="payload-output" class="textarea textarea-bordered w-full font-mono text-xs" rows="8" placeholder="ç‚¹å‡» [ç”Ÿæˆè½½è·] æŒ‰é’®..."></textarea>
                                    </div>

                                    <div class="card-actions mt-4 grid grid-cols-2 gap-4">
                                        <button onclick="generatePayload()" class="btn btn-primary">
                                            <i data-lucide="play" class="w-4 h-4"></i> ç”Ÿæˆè½½è·
                                        </button>
                                        <button onclick="copyToClipboard('payload-output', 'è½½è·å·²å¤åˆ¶')" class="btn btn-ghost">
                                            <i data-lucide="copy" class="w-4 h-4"></i> å¤åˆ¶
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <!-- [AXIOM V2.0.4] ç»“æŸ: è½½è·ç”Ÿæˆå™¨è§†å›¾ -->


                <!-- 5. ç³»ç»Ÿé…ç½®/æ—¥å¿—è§†å›¾ -->
                <div id="view-settings" class="hidden">
                    <!-- ... [ä¿ç•™çš„è®¾ç½®è§†å›¾] ... -->
                    <h2 class="text-2xl font-bold text-base-content mb-6">ğŸ› ï¸ ç³»ç»Ÿé…ç½®/æ—¥å¿—</h2>
                    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        
                        <div class="card bg-base-100 shadow-xl">
                            <form id="global-settings-form" onsubmit="event.preventDefault(); saveGlobalSettings();" class="card-body p-6">
                                <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">
                                    <i data-lucide="zap" class="w-5 h-5 mr-1 text-warning"></i>
                                    å…¨å±€å®‰å…¨è®¾ç½®
                                </h3>
                                <div class="form-control">
                                    <label class="label" for="global-fuse-threshold">
                                        <span class="label-text">è‡ªåŠ¨é€Ÿç‡ç†”æ–­é˜ˆå€¼ (KB/s)</span>
                                    </label>
                                    <input type="number" id="global-fuse-threshold" value="0" min="0" required class="input input-bordered w-full" aria-label="è‡ªåŠ¨é€Ÿç‡ç†”æ–­é˜ˆå€¼">
                                    <label class="label">
                                        <span class="label-text-alt">å½“å•ä¸ªç”¨æˆ·å®æ—¶é€Ÿç‡è¶…è¿‡æ­¤å€¼, å°†è¢«è‡ªåŠ¨æš‚åœã€‚ (0 = ä¸å¯ç”¨)</span>
                                    </label>
                                </div>
                                <div class="card-actions mt-2">
                                    <button type="submit" class="btn btn-primary w-full">
                                        <i data-lucide="save" class="w-4 h-4"></i> ä¿å­˜å…¨å±€è®¾ç½®
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="card bg-base-100 shadow-xl">
                            <form id="change-password-form" class="card-body p-6">
                                <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">é¢æ¿å®‰å…¨</h3>
                                <div class="form-control">
                                    <label class="label" for="old-password"><span class="label-text">å½“å‰å¯†ç </span></label>
                                    <input type="password" id="old-password" required class="input input-bordered w-full">
                                </div>
                                <div class="form-control">
                                    <label class="label" for="admin-new-password"><span class="label-text">æ–°å¯†ç  (è‡³å°‘6ä½)</span></label>
                                    <!-- [AXIOM V2.0.4] ä¿®å¤: æ›´æ”¹ ID -->
                                    <input type="password" id="admin-new-password" required minlength="6" class="input input-bordered w-full">
                                </div>
                                <div class="form-control">
                                    <label class="label" for="admin-confirm-new-password"><span class="label-text">ç¡®è®¤æ–°å¯†ç </span></label>
                                    <!-- [AXIOM V2.0.4] ä¿®å¤: æ›´æ”¹ ID -->
                                    <input type="password" id="admin-confirm-new-password" required minlength="6" class="input input-bordered w-full">
                                </div>
                                <div class="card-actions mt-2">
                                    <button type="submit" class="btn btn-primary w-full">
                                        <i data-lucide="key" class="w-4 h-4"></i> ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="card bg-base-100 shadow-xl">
                            <div class="card-body p-6">
                                <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">æ ¸å¿ƒæœåŠ¡æ—¥å¿— (æœ€æ–° 50 è¡Œ)</h3>
                                <div class="space-y-4">
                                    <div class="btn-group flex-wrap gap-1">
                                        <button onclick="fetchServiceLogs('wss')" class="btn btn-ghost btn-sm">WSS Proxy</button>
                                        <button onclick="fetchServiceLogs('stunnel4')" class="btn btn-ghost btn-sm">Stunnel4</button>
                                        <button onclick="fetchServiceLogs('udpgw')" class="btn btn-ghost btn-sm">UDPGW</button>
                                        <button onclick="fetchServiceLogs('wss_panel')" class="btn btn-ghost btn-sm">Web Panel</button>
                                    </div>
                                    <div class="mockup-code bg-gray-800 text-gray-200 text-xs">
                                        <pre id="service-log-content" class="log-pre p-4">è¯·é€‰æ‹©æœåŠ¡åŠ è½½æ—¥å¿—...</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card bg-base-100 shadow-xl md:col-span-2">
                            <div class="card-body p-6">
                                <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">ç®¡ç†å‘˜å®¡è®¡æ—¥å¿— (æœ€æ–°æ´»åŠ¨)</h3>
                                <div class="bg-base-200 p-3 rounded-lg max-h-[300px] overflow-y-auto border border-base-300">
                                     <div id="audit-log-content" class="text-xs text-gray-700 space-y-1">æ­£åœ¨åŠ è½½å®¡è®¡æ—¥å¿—...</div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- 6. å®‰å…¨/IP å°ç¦åˆ—è¡¨è§†å›¾ -->
                <div id="view-security" class="hidden">
                    <!-- ... [ä¿ç•™çš„ IP å°ç¦è§†å›¾] ... -->
                    <h2 class="text-2xl font-bold text-base-content mb-6">ğŸ”’ å…¨å±€ IP å°ç¦ç®¡ç†</h2>
                    <section class="card bg-base-100 shadow-xl mb-8">
                        <div class="card-body p-6">
                            <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">IPTables å…¨å±€å°ç¦ IP åˆ—è¡¨</h3>
                            <div id="global-ban-list" class="space-y-3 max-h-96 overflow-y-auto p-3 bg-base-200 rounded-lg border border-base-300">
                                <p class="text-gray-500">æ­£åœ¨åŠ è½½å…¨å±€ IP å°ç¦åˆ—è¡¨...</p>
                            </div>
                        </div>
                    </section>
                    
                    <section class="card bg-base-100 shadow-xl">
                        <div class="card-body p-6">
                            <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">æ–°å¢å…¨å±€å°ç¦ IP</h3>
                            <form id="add-global-ban-form" class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                                <input type="text" id="global-ban-ip" placeholder="è¾“å…¥è¦å°ç¦çš„ IP åœ°å€" required
                                       class="input input-bordered input-error w-full flex-1">
                                <button type="submit" class="btn btn-error flex-shrink-0">
                                    <i data-lucide="ban" class="w-4 h-4"></i> å…¨å±€å°ç¦
                                </button>
                            </form>
                        </div>
                    </section>
                </div>
                
                <!-- [AXIOM V2.0.1] æ–°å¢: 8. ç«¯å£é…ç½®è§†å›¾ -->
                <div id="view-port-config" class="hidden">
                    <h2 class="text-2xl font-bold text-base-content mb-6">ğŸ”Œ æœåŠ¡ç«¯å£é…ç½®</h2>
                    <section class="card bg-base-100 shadow-xl">
                        <form id="port-config-form" onsubmit="event.preventDefault(); saveGlobalConfig();" class="card-body p-6">
                            <h3 class="card-title text-xl font-semibold text-base-content border-b border-base-300 pb-3">æ ¸å¿ƒç«¯å£è®¾ç½®</h3>
                            <p class="text-sm text-gray-600 mb-6">
                                è­¦å‘Šï¼šä¿®æ”¹ç«¯å£åï¼Œç›¸å…³æœåŠ¡å°†è‡ªåŠ¨é‡å¯ã€‚
                                å¦‚æœæ‚¨ä¿®æ”¹äº† **Web é¢æ¿ç«¯å£**ï¼Œæ­¤é¡µé¢å°†åœ¨ä¿å­˜åè‡ªåŠ¨æ–­å¼€ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æ–°ç«¯å£è®¿é—®ã€‚
                            </p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <!-- åˆ— 1: å¤–éƒ¨ç«¯å£ -->
                                <div class="space-y-4 p-4 bg-base-200 rounded-lg border border-base-300">
                                    <h4 class="font-semibold text-lg text-base-content">å¤–éƒ¨ç«¯å£ (é¢å‘ç”¨æˆ·)</h4>
                                    <div class="form-control">
                                        <label class="label" for="config-panel-port">
                                            <span class="label-text">Web é¢æ¿ç«¯å£ (HTTP)</span>
                                        </label>
                                        <input type="number" id="config-panel-port" min="1" max="65535" required class="input input-bordered w-full">
                                    </div>
                                    <div class="form-control">
                                        <label class="label" for="config-wss-http-port">
                                            <span class="label-text">WSS ä»£ç†ç«¯å£ (HTTP)</span>
                                        </label>
                                        <input type="number" id="config-wss-http-port" min="1" max="65535" required class="input input-bordered w-full">
                                    </div>
                                    <div class="form-control">
                                        <label class="label" for="config-wss-tls-port">
                                            <span class="label-text">WSS ä»£ç†ç«¯å£ (TLS/SSL)</span>
                                        </label>
                                        <input type="number" id="config-wss-tls-port" min="1" max="65535" required class="input input-bordered w-full">
                                    </div>
                                    <div class="form-control">
                                        <label class="label" for="config-stunnel-port">
                                            <span class="label-text">Stunnel (SSH/TLS) ç«¯å£</span>
                                        </label>
                                        <input type="number" id="config-stunnel-port" min="1" max="65535" required class="input input-bordered w-full">
                                    </div>
                                    <div class="form-control">
                                        <label class="label" for="config-udpgw-port">
                                            <span class="label-text">UDPGW (Badvpn) ç«¯å£</span>
                                        </label>
                                        <input type="number" id="config-udpgw-port" min="1" max="65535" required class="input input-bordered w-full">
                                    </div>
                                </div>
                                
                                <!-- åˆ— 2: å†…éƒ¨ç«¯å£ -->
                                <div class="space-y-4 p-4 bg-base-200 rounded-lg border border-base-300">
                                    <h4 class="font-semibold text-lg text-base-content">å†…éƒ¨ç«¯å£ (ä»… 127.0.0.1)</h4>
                                    
                                    <div class="form-control">
                                        <label class="label" for="config-internal-forward-port">
                                            <span class="label-text">å†…éƒ¨ SSH (WSS) è½¬å‘ç«¯å£</span>
                                        </label>
                                        <input type="number" id="config-internal-forward-port" min="1" max="65535" required class="input input-bordered w-full">
                                        <label class="label">
                                            <span class="label-text-alt">WSS ä»£ç†å°†æµé‡è½¬å‘åˆ°æ­¤ç«¯å£ (é€šå¸¸æ˜¯ 22)ã€‚</span>
                                        </label>
                                    </div>

                                    <!-- [AXIOM V2.0.5] ä¿®å¤: ç§»é™¤å·²è¢«åºŸå¼ƒçš„ internal_ipc_port -->
                                    
                                    <div class="form-control">
                                        <label class="label" for="config-internal-api-port">
                                            <span class="label-text">å†…éƒ¨ API ç«¯å£ (Proxy -> Panel)</span>
                                        </label>
                                        <input type="number" id="config-internal-api-port" min="1" max="65535" required class="input input-bordered w-full" disabled>
                                        <label class="label">
                                            <span class="label-text-alt">æ­¤ç«¯å£ (54322) ä¸å¯ä¿®æ”¹ï¼Œç”¨äºç»Ÿè®¡ã€‚</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-actions mt-6">
                                <button type="submit" class="btn btn-primary w-full sm:w-auto flex-shrink-0">
                                    <i data-lucide="save" class="w-4 h-4"></i> ä¿å­˜å¹¶é‡å¯ç›¸å…³æœåŠ¡
                                </button>
                            </div>
                        </form>
                    </section>
                </div>


            </main>
        </div> 

        <!-- ======================= -->
        <!-- ä¾§è¾¹æ  (Drawer Side)     -->
        <!-- ======================= -->
        <aside class="drawer-side z-40">
            <!-- ... [ä¿ç•™çš„ä¾§è¾¹æ å†…å®¹] ... -->
            <label for="my-drawer-2" aria-label="close sidebar" class="drawer-overlay"></label> 
            <ul id="sidebar-menu" class="menu p-4 w-64 min-h-full bg-base-100 text-base-content shadow-lg">
                <!-- [AXIOM V2.2.1] å¸ƒå±€: ä¼˜åŒ–ä¾§è¾¹æ åˆ†ç»„ -->
                <li class="mt-4">
                    <a onclick="switchView('dashboard')" class="nav-link text-base active" data-view="dashboard" id="nav-dashboard">
                        <i data-lucide="layout-dashboard" class="w-4 h-4"></i> ä»ªè¡¨ç›˜
                    </a>
                </li>
                <li>
                    <a onclick="switchView('users')" class="nav-link text-base" data-view="users" id="nav-users">
                        <i data-lucide="users" class="w-4 h-4"></i> ç”¨æˆ·ç®¡ç†
                    </a>
                </li>
                
                <li class="menu-title"><span class="text-base-content/60">éš§é“ç®¡ç†</span></li>
                <li>
                    <a onclick="switchView('live-ips')" class="nav-link text-base" data-view="live-ips" id="nav-live-ips">
                        <i data-lucide="activity" class="w-4 h-4"></i> å®æ—¶è¿æ¥ IP
                    </a>
                </li>
                <li>
                    <a onclick="switchView('payload-gen')" class="nav-link text-base" data-view="payload-gen" id="nav-payload-gen">
                        <i data-lucide="flask-conical" class="w-4 h-4"></i> è½½è·ç”Ÿæˆå™¨
                    </a>
                </li>
                <li>
                    <a onclick="switchView('hosts')" class="nav-link text-base" data-view="hosts" id="nav-hosts">
                        <i data-lucide="globe" class="w-4 h-4"></i> Host ç™½åå•
                    </a>
                </li>
                
                <li class="menu-title"><span class="text-base-content/60">ç³»ç»Ÿä¸å®‰å…¨</span></li>
                 <li>
                    <a onclick="switchView('port-config')" class="nav-link text-base" data-view="port-config" id="nav-port-config">
                        <i data-lucide="plug-zap" class="w-4 h-4"></i> ç«¯å£é…ç½®
                    </a>
                </li>
                <li>
                    <a onclick="switchView('security')" class="nav-link text-base" data-view="security" id="nav-security">
                        <i data-lucide="shield-alert" class="w-4 h-4"></i> å…¨å±€ IP å°ç¦
                    </a>
                </li>
                <li>
                    <a onclick="switchView('settings')" class="nav-link text-base" data-view="settings" id="nav-settings">
                        <i data-lucide="settings" class="w-4 h-4"></i> ç³»ç»Ÿé…ç½®/æ—¥å¿—
                    </a>
                </li>
            </ul>
        </aside>
    </div>

    <!-- 
      =====================================================================
      MODALS
      =====================================================================
    -->
    
    <!-- [AXIOM V2.2.1] å¸ƒå±€: æ–°å¢â€œæ·»åŠ ç”¨æˆ·â€æ¨¡æ€æ¡† -->
    <dialog id="add-user-modal" class="modal">
        <div class="modal-box max-w-4xl">
            <h3 class="text-xl font-bold mb-4 border-b pb-2">æ–°å¢ SSH éš§é“ç”¨æˆ·</h3>
            <!-- [AXIOM V2.2.1] å¸ƒå±€: å°†è¡¨å•ç§»åŠ¨åˆ°æ­¤å¤„ -->
            <form id="add-user-form">
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
                    <div class="form-control md:col-span-2">
                        <label class="label" for="new-username"><span class="label-text">ç”¨æˆ·å (Username)</span></label>
                        <input type="text" id="new-username" placeholder="ç”¨æˆ·å (Username)" required class="input input-bordered w-full">
                    </div>
                    <div class="form-control md:col-span-2">
                        <label class="label" for="new-password"><span class="label-text">å¯†ç  (Password)</span></label>
                        <input type="password" id="new-password" placeholder="å¯†ç  (Password)" required class="input input-bordered w-full">
                    </div>
                    <div class="form-control md:col-span-1">
                        <label class="label" for="expiration-days"><span class="label-text">æœ‰æ•ˆæœŸ (å¤©)</span></label>
                        <input type="number" id="expiration-days" value="365" min="1" required class="input input-bordered w-full" aria-label="ç”¨æˆ·æœ‰æ•ˆæœŸï¼Œå•ä½å¤©">
                    </div>
                    <div class="form-control md:col-span-1">
                        <label class="label" for="quota-gb"><span class="label-text">é…é¢ (GB, 0=âˆ)</span></label>
                        <input type="number" id="quota-gb" value="0" min="0" required class="input input-bordered w-full" aria-label="ç”¨æˆ·æµé‡é…é¢ï¼Œå•ä½GB">
                    </div>
                    
                    <div class="form-control md:col-span-2">
                        <label class="label" for="rate-kbps"><span class="label-text">é™é€Ÿ (KB/s, 0=âˆ)</span></label>
                        <input type="number" id="rate-kbps" value="0" min="0" required class="input input-bordered w-full" aria-label="ç”¨æˆ·æœ€å¤§é€Ÿåº¦ï¼Œå•ä½KB/ç§’">
                    </div>
                    <div class="form-control md:col-span-2">
                        <label class="label" for="new-max-connections"><span class="label-text">å¹¶å‘è¿æ¥æ•° (0=âˆ)</span></label>
                        <input type="number" id="new-max-connections" value="2" min="0" required class="input input-bordered w-full" aria-label="å¹¶å‘è¿æ¥æ•°é™åˆ¶">
                    </div>
                    
                    <!-- [AXIOM V2.2.0] ä¿®å¤: ä»¤ç‰Œç”Ÿæˆå™¨ UI -->
                    <div class="form-control md:col-span-2">
                        <label class="label" for="new-connect-token"><span class="label-text">Base64 è¿æ¥ä»¤ç‰Œ</span></label>
                        <div class="token-input-group">
                            <input type="text" id="new-connect-token" readonly class="input input-bordered w-full font-mono text-sm bg-base-200" value="[åœ¨æ­¤è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ]">
                            <button type="button" onclick="copyToClipboard('new-connect-token', 'è¿æ¥ä»¤ç‰Œå·²å¤åˆ¶')" class="btn btn-primary btn-square btn-sm flex-shrink-0" aria-label="å¤åˆ¶è¿æ¥ä»¤ç‰Œ">
                                <i data-lucide="copy" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-control md:col-span-1 md:self-center">
                        <label class="label cursor-pointer" for="new-require-auth">
                            <span class="label-text">éœ€è¦è®¤è¯å¤´</span>
                        </label>
                        <input type="checkbox" id="new-require-auth" class="toggle toggle-primary toggle-sm" checked>
                    </div>
                    
                    <div class="form-control md:col-span-1 md:self-center">
                        <label class="label cursor-pointer" for="new-allow-shell">
                            <span class="label-text">å…è®¸ Shell (444)</span>
                        </label>
                        <input type="checkbox" id="new-allow-shell" class="toggle toggle-secondary toggle-sm">
                    </div>
                </div>
                
                <div class="modal-action mt-6">
                    <button type="button" onclick="closeModal('add-user-modal')" class="btn btn-ghost">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">
                        <i data-lucide="user-plus" class="w-4 h-4"></i> åˆ›å»ºç”¨æˆ·
                    </button>
                </div>
            </form>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>


    <!-- [AXIOM V1.4] æ¨¡æ€æ¡†ï¼šè®¾ç½®ç”¨æˆ· (ä¿®æ”¹) -->
    <dialog id="settings-modal" class="modal">
        <div class="modal-box max-w-lg">
            <h3 class="text-xl font-bold mb-4 border-b pb-2">è®¾ç½® <span id="modal-username-title-settings" class="text-primary"></span> çš„å‚æ•°</h3>
            <form id="settings-form" onsubmit="event.preventDefault(); saveUserSettings();">
                <input type="hidden" id="modal-username-setting">
                
                <div class="space-y-4">
                    <!-- ... [ä¿ç•™çš„è®¾ç½®æ¨¡æ€æ¡†ä¸ŠåŠéƒ¨åˆ†] ... -->
                    <div class="form-control">
                        <label class="label" for="modal-expiry-date"><span class="label-text">åˆ°æœŸæ—¥æœŸ (YYYY-MM-DD, æ°¸ä¸ç•™ç©º)</span></label>
                        <input type="date" id="modal-expiry-date" class="input input-bordered w-full">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label" for="modal-quota-gb"><span class="label-text">æµé‡é™é¢ (GB, 0=æ— é™åˆ¶)</span></label>
                            <input type="number" id="modal-quota-gb" min="0" required class="input input-bordered w-full">
                        </div>
                        <div class="form-control">
                            <label class="label" for="modal-rate-kbps"><span class="label-text">æœ€å¤§é€Ÿåº¦ (KB/s, 0=æ— é™åˆ¶)</span></label>
                            <input type="number" id="modal-rate-kbps" min="0" required class="input input-bordered w-full">
                        </div>
                    </div>
                    <div class="form-control">
                        <label class="label" for="modal-max-connections"><span class="label-text">å¹¶å‘è¿æ¥æ•° (0=æ— é™åˆ¶)</span></label>
                        <input type="number" id="modal-max-connections" value="2" min="0" required class="input input-bordered w-full" aria-label="å¹¶å‘è¿æ¥æ•°é™åˆ¶">
                    </div>
                    
                    <!-- [AXIOM V1.4] æ–°å¢ Shell è®¿é—®å¼€å…³ -->
                    <div class="form-control">
                        <label class="label cursor-pointer">
                            <span class="label-text">éœ€è¦ Proxy-Authorization è®¤è¯</span>
                            <input type="checkbox" id="modal-require-auth" class="toggle toggle-primary">
                        </label>
                        <label class="label">
                            <span class="label-text-alt text-gray-500">ç¦ç”¨åï¼Œå®¢æˆ·ç«¯å¯é€šè¿‡ URI å‚æ•° `/?user=<username>` è¿æ¥ã€‚</span>
                        </label>
                    </div>
                    
                    <div class="form-control">
                        <label class="label cursor-pointer">
                            <span class="label-text">å…è®¸ Shell è®¿é—® (ç”¨äº 444 Stunnel)</span>
                            <input type="checkbox" id="modal-allow-shell" class="toggle toggle-secondary">
                        </label>
                        <label class="label">
                            <span class="label-text-alt text-gray-500">å¯ç”¨åï¼Œæ­¤ç”¨æˆ·å°†è·å¾—ç³»ç»Ÿ Shell æƒé™ã€‚</span>
                        </label>
                    </div>


                    <div class="border-t pt-4">
                        <h4 class="font-bold mb-2">è¿æ¥ä¿¡æ¯ä¸å¯†ç </h4>
                        
                        <!-- [AXIOM V1.0] ä»¤ç‰Œç”Ÿæˆé€»è¾‘ä¿®æ”¹ -->
                        <div class="form-control mb-4">
                            <label class="label" for="modal-connect-token"><span class="label-text">Base64 è¿æ¥ä»¤ç‰Œ</span></label>
                            <div class="token-input-group">
                                <input type="text" id="modal-connect-token" readonly class="input input-bordered w-full font-mono text-sm bg-base-200" value="[*********]">
                                <button type="button" onclick="copyToClipboard('modal-connect-token', 'è¿æ¥ä»¤ç‰Œå·²å¤åˆ¶')" class="btn btn-primary btn-square btn-sm flex-shrink-0" aria-label="å¤åˆ¶è¿æ¥ä»¤ç‰Œ">
                                    <i data-lucide="copy" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <label class="label">
                                <span class="label-text-alt text-gray-500 mt-1">æ ¼å¼: `username:password` çš„ Base64 ç¼–ç ã€‚ä¿®æ”¹ä¸‹æ–¹å¯†ç æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚</span>
                            </label>
                        </div>
                        
                        <div class="form-control">
                            <label class="label" for="modal-new-password"><span class="label-text">ä¿®æ”¹å¯†ç  (é€‰å¡«)</span></label>
                            <input type="password" id="modal-new-password" placeholder="ç•™ç©ºåˆ™ä¸ä¿®æ”¹" class="input input-bordered w-full">
                            <label class="label">
                                <span class="label-text-alt text-gray-500 mt-1">æ³¨æ„ï¼šä¿®æ”¹å¯†ç åï¼Œæ‰€æœ‰è¯¥ç”¨æˆ·å½“å‰æ´»è·ƒçš„è¿æ¥å°†è¢«å¼ºåˆ¶æ–­å¼€ã€‚</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="modal-action mt-6 flex flex-col sm:flex-row justify-between w-full gap-3">
                    <button type="button" onclick="confirmAction(document.getElementById('modal-username-setting').value, null, null, 'resetTraffic', 'é‡ç½®æµé‡')" 
                            class="btn btn-warning w-full sm:w-auto">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> é‡ç½®æµé‡
                    </button>
                    <div class="flex space-x-3">
                        <button type="button" onclick="closeModal('settings-modal')" class="btn btn-ghost">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">
                            <i data-lucide="save" class="w-4 h-4"></i> ä¿å­˜è®¾ç½®
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>
    
    <!-- æ¨¡æ€æ¡†ï¼šæµé‡å†å²å›¾è¡¨ -->
    <dialog id="traffic-chart-modal" class="modal">
        <!-- ... [ä¿ç•™çš„æµé‡å›¾æ¨¡æ€æ¡†] ... -->
         <div class="modal-box max-w-3xl">
            <h3 class="text-xl font-bold mb-4 border-b pb-2">ç”¨æˆ· <span id="traffic-chart-username-title" class="text-primary"></span> çš„30å¤©æµé‡å†å²</h3>
            <div class="relative h-64 md:h-96">
                <canvas id="trafficChartCanvas"></canvas>
            </div>
            <p id="traffic-chart-loading" class="text-center text-gray-500 mt-4">æ­£åœ¨åŠ è½½æµé‡æ•°æ®...</p>
            <div class="modal-action mt-6">
                <button type="button" onclick="closeModal('traffic-chart-modal')" class="btn btn-ghost">å…³é—­</button>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- æ¨¡æ€æ¡†ï¼šé€šç”¨ç¡®è®¤ -->
    <dialog id="confirm-modal" class="modal">
        <!-- ... [ä¿ç•™çš„ç¡®è®¤æ¨¡æ€æ¡†] ... -->
        <div class="modal-box max-w-sm" role="alertdialog" aria-modal="true" aria-labelledby="confirm-title">
            <h3 class="text-xl font-bold mb-4 border-b pb-2" id="confirm-title"></h3>
            <p id="confirm-message" class="text-gray-700 mb-6"></p>
            <div class="modal-action">
                <button type="button" onclick="closeModal('confirm-modal')" class="btn btn-ghost">å–æ¶ˆ</button>
                <button type="button" id="confirm-action-btn" class="btn btn-error">ç¡®è®¤</button>
            </div>
            <input type="hidden" id="confirm-param1">
            <input type="hidden" id="confirm-param2">
            <input type="hidden" id="confirm-param3">
            <input type="hidden" id="confirm-type">
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>
    
    <!-- 
      =====================================================================
      [AXIOM V2.0] è„šæœ¬åˆ†ç¦»
      - ç§»é™¤æ‰€æœ‰å†…è”çš„ <script>...</script> 
      - ç§»é™¤ FLASK_CONFIG å—
      - æ·»åŠ å¯¹ app.js çš„å¼•ç”¨
      =====================================================================
    -->
    <script src="app.js" defer></script>

</body>
</html>
